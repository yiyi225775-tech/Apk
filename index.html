<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSO VIP - All-in-One Admin</title>
    <style>
        :root { --primary: #0d6efd; --success: #198754; --danger: #dc3545; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 25px; }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }

        .grid-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 15px; }
        
        .btn { cursor: pointer; border: none; border-radius: 6px; font-weight: bold; transition: 0.3s; color: white; padding: 12px; }
        .btn-save { background-color: var(--success); width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-save:hover { background-color: #157347; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #666; }
        
        .action-btns { display: flex; gap: 10px; }
        .btn-del { background-color: var(--danger); font-size: 12px; padding: 5px 10px; }
        .btn-print { background-color: var(--primary); font-size: 12px; padding: 5px 10px; }

        /* Slip Design for Printing */
        #slip-box { display: none; }
        @media print {
            body * { visibility: hidden; }
            #slip-box, #slip-box * { visibility: visible; }
            #slip-box { position: absolute; left: 0; top: 0; width: 100%; display: block !important; 
                        text-align: center; padding: 30px; border: 2px solid #000; }
            .slip-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Add New User</h2>
        <div class="grid-form">
            <div class="full-width">
                <label>Document ID (Unique ID)</label>
                <input type="text" id="docId" placeholder="ဥပမာ- b67b3ac683d5b081">
            </div>
            <div>
                <label>Username (အမည်)</label>
                <input type="text" id="username" placeholder="User နာမည်ရိုက်ပါ">
            </div>
            <div>
                <label>Expiry Date (သက်တမ်းကုန်ရက်)</label>
                <input type="date" id="expiry">
            </div>
        </div>
        <button id="saveBtn" class="btn btn-save">SAVE DATA & PRINT SLIP</button>
    </div>

    <div class="card">
        <h2>All Users List</h2>
        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Expiry Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="userTable">
                </tbody>
        </table>
    </div>
</div>

<div id="slip-box">
    <div class="slip-title">KSO VIP SERVICE</div>
    <p>***************************************</p>
    <p><strong>Customer ID:</strong> <span id="p-id"></span></p>
    <p><strong>Name:</strong> <span id="p-name"></span></p>
    <p><strong>Expiry:</strong> <span id="p-exp"></span></p>
    <p>***************************************</p>
    <p>Thank You!</p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDGCsxM1ccZ_ZswwNPZDI-ykOm5yJU1CIw",
        authDomain: "ksovip-f4ffd.firebaseapp.com",
        projectId: "ksovip-f4ffd",
        storageBucket: "ksovip-f4ffd.appspot.com",
        messagingSenderId: "400346502182",
        appId: "1:400346502182:android:a01ef07542426892fc82e7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "users");

    // Save & Print Function
    document.getElementById("saveBtn").onclick = async () => {
        const id = document.getElementById("docId").value;
        const name = document.getElementById("username").value;
        const exp = document.getElementById("expiry").value;

        if (id && name && exp) {
            await setDoc(doc(db, "users", id), { username: name, expiryDate: exp, isActive: true });
            
            // Set Print Data
            document.getElementById("p-id").innerText = id;
            document.getElementById("p-name").innerText = name;
            document.getElementById("p-exp").innerText = exp;
            
            window.print(); // Print ထုတ်ရန် Window ခေါ်ခြင်း

            // Clear Input
            document.getElementById("docId").value = "";
            document.getElementById("username").value = "";
            document.getElementById("expiry").value = "";
        } else {
            alert("အချက်အလက် အကုန်ဖြည့်ပါ");
        }
    };

    // Real-time List Display
    onSnapshot(colRef, (snap) => {
        const table = document.getElementById("userTable");
        table.innerHTML = "";
        snap.forEach(d => {
            const data = d.data();
            table.innerHTML += `
                <tr>
                    <td><strong>${data.username}</strong></td>
                    <td>${data.expiryDate}</td>
                    <td class="action-btns">
                        <button class="btn btn-print" onclick="printExisting('${d.id}', '${data.username}', '${data.expiryDate}')">Print</button>
                        <button class="btn btn-del" onclick="deleteUser('${d.id}')">Delete</button>
                    </td>
                </tr>
            `;
        });
    });

    // Delete Function
    window.deleteUser = async (id) => {
        if(confirm("ဖျက်မှာ သေချာပါသလား?")) await deleteDoc(doc(db, "users", id));
    };

    // Print Existing Function
    window.printExisting = (id, name, exp) => {
        document.getElementById("p-id").innerText = id;
        document.getElementById("p-name").innerText = name;
        document.getElementById("p-exp").innerText = exp;
        window.print();
    };

</script>
</body>
</html>
